<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>User Demo</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  
  <style>
    body {
      background-color: #f8f9fa;
    }

    .imgbanner {
      width: 100%;
      height: auto;
    }

    .flex {
      display: flex;
      justify-content: space-evenly;
      padding: 20px;
      flex-wrap: wrap;
    }

    .cardbutton {
      width: 60px;
      height: 60px;
      border: none;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #495057;
      background-color: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .cardbutton:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
      cursor: pointer;
    }

    .fas {
      font-size: 1.25rem;
    }

    .buttonflex {
      background-color: #ffffff;
      border-radius: 20px;
    }

    .btn i {
      font-size: 1rem;
    }

    .rounded {
      width: 60px;
      height: 60px;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .rounded:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
      cursor: pointer;
    }

    .produkdisplay {
      margin-bottom: 20px;
    }

    .imgtroli {
      width: 40px;
      height: auto;
    }

    /* Additional Styling */
    .card {
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .cardbutton {
        width: 50px;
        height: 50px;
      }

      .rounded {
        width: 50px;
        height: 50px;
      }

      .produkdisplay {
        width: calc(50% - 10px); /* Adjusting for padding/margin */
      }
    }

    @media (max-width: 576px) {
      .flex {
        flex-direction: column;
        align-items: center;
      }

      .produkdisplay {
        width: calc(100% - 10px);
      }
    }

    .produk {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
      gap: 1rem;
    }
  </style>
</head>

<body>
  <!-- Carousel -->
  <div id="carouselExampleSlidesOnly" class="carousel slide animate__animated animate__fadeIn" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="https://i.ibb.co.com/D97xQ6Z/Banner1.jpg" class="d-block imgbanner w-100" alt="Banner 1" loading="lazy">
      </div>
      <div class="carousel-item">
        <img src="https://i.ibb.co.com/prDKyBQ/Banner2.jpg" class="d-block imgbanner w-100" alt="Banner 2" loading="lazy">
      </div>
      <div class="carousel-item">
        <img src="https://i.ibb.co.com/D97xQ6Z/Banner1.jpg" class="d-block imgbanner w-100" alt="Banner 3" loading="lazy">
      </div>
    </div>
  </div>
  <br>

  <!-- Button Flex -->
  <div class="container">
    <div class="buttonflex flex animate__animated animate__fadeInUp">
      <div>
        <div class="card cardbutton border border-primary">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <center>Pulsa</center>
      </div>
      <div>
        <div class="card cardbutton border border-primary">
          <i class="fas fa-utensils"></i>
        </div>
        <center>Food</center>
      </div>
      <div>
        <div class="card cardbutton border border-primary">
          <i class="fas fa-wallet"></i>
        </div>
        <center>Hawil +</center>
      </div>
      <div>
        <div class="card cardbutton border border-primary" onclick="window.location.href='riwayatuser.html'">
          <i class="fas fa-ellipsis-h"></i>
        </div>
        <center>More</center>
      </div>
    </div>
    <br>
  </div>

  <!-- Produk Container -->
  <div class="container produk animate__animated animate__fadeInUp"></div>

  <!-- Shopping Cart Button -->
  <button class="btn btn-primary rounded rounded-circle animate__animated animate__bounceIn" data-bs-toggle="modal" data-bs-target="#exampleModal">
    <i class="fas fa-shopping-cart"></i>
  </button>
  <button class="btn btn-danger ms-3" onclick="logout()">Logout</button>

  <!-- Modal -->
  <div class="modal fade animate__animated animate__zoomIn" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Keranjang</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="keranjang">
          <!-- Keranjang Items akan dimasukkan di sini -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="checkout()">Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <!-- JavaScript -->
  <script>
    function logout() {
      localStorage.removeItem('user');
      window.location.href = 'loginuser.html';
    }

    window.onload = function () {
      const user = JSON.parse(localStorage.getItem('user'));
      if (!user || !user.email) {
        window.location.href = 'loginuser.html';
        return;
      }
      fetchProduk();
      fetchKeranjang();
    };

    let datafinal = []
    async function fetchProduk() {
      try {
        const response = await fetch('https://posdata-16c78-default-rtdb.firebaseio.com/produk.json');
        const data = await response.json();
        const user = JSON.parse(localStorage.getItem('user'));
        const produkContainer = document.querySelector('.produk');
        produkContainer.innerHTML = ''; // clear previous content

        for (const key in data) {
          if (data[key].email === user.email) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'produkdisplay card';
            cardDiv.innerHTML = `
              <img src="${data[key].imgurl}" class="card-img-top" alt="Image for ${data[key].namaproduk}" loading="lazy">
              <div class="card-body">
                <h5 class="card-title">${data[key].namaproduk}</h5>
                <p class="card-text">Harga: Rp ${data[key].harga}</p>
                <button id="edit-${key}" class="btn btn-primary" onclick="editProduk('${data[key].namaproduk}', '${data[key].harga}', '${data[key].stok}', '${key}')">Edit</button>
                <button class="btn btn-success ms-2" onclick="addToCart('${key}', '${data[key].namaproduk}', '${data[key].harga}', '${data[key].stok}', '${data[key].imgurl}')">Beli</button>
              </div>`;
            produkContainer.appendChild(cardDiv);
          }
        }
      } catch (error) {
        console.error('Error fetching produk:', error);
      }
    }

    function addToCart(key, namaproduk, harga, stok, imgurl) {
      const user = JSON.parse(localStorage.getItem('user'));
      fetch(`https://posdata-16c78-default-rtdb.firebaseio.com/keranjang/${key}.json`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: user.email,
          namaproduk: namaproduk,
          harga: harga,
          stok: stok,
          imgurl: imgurl,
          qtypro: 1,
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Product added to cart:', data);
        fetchKeranjang();
      })
      .catch(error => console.error('Error adding to cart:', error));
    }

    async function fetchKeranjang() {
      try {
        const response = await fetch('https://posdata-16c78-default-rtdb.firebaseio.com/keranjang.json');
        const data = await response.json();
        const user = JSON.parse(localStorage.getItem('user'));
        const keranjangContainer = document.getElementById('keranjang');
        keranjangContainer.innerHTML = ''; // clear previous content
        let totalHarga = 0;

        for (const key in data) {
          if (data[key].email === user.email) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'd-flex justify-content-between align-items-center mb-2';
            itemDiv.innerHTML = `
              <div>
                <img src="${data[key].imgurl}" class="imgtroli me-2" alt="Image for ${data[key].namaproduk}" loading="lazy">
                <strong>${data[key].namaproduk}</strong>
              </div>
              <div>
                Rp ${data[key].harga} x ${data[key].qtypro}
              </div>`;
            keranjangContainer.appendChild(itemDiv);
            totalHarga += data[key].harga * data[key].qtypro;
          }
        }

        const totalDiv = document.createElement('div');
        totalDiv.className = 'd-flex justify-content-between align-items-center mt-3 border-top pt-3';
        totalDiv.innerHTML = `<strong>Total: Rp ${totalHarga}</strong>`;
        keranjangContainer.appendChild(totalDiv);
      } catch (error) {
        console.error('Error fetching keranjang:', error);
      }
    }

    function checkout() {
      alert('Checkout berhasil!');
    }

    function editProduk(namaproduk, harga, stok, key) {
      alert(`Edit Produk: ${namaproduk}, Harga: ${harga}, Stok: ${stok}, Key: ${key}`);
    }
  </script>
</body>
</html>
